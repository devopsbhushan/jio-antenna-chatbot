<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jio Antenna Chatbot</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f0f2f5;
      display: flex; flex-direction: column; height: 100vh; overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #d50000, #b71c1c);
      color: white; padding: 14px 20px;
      display: flex; align-items: center; gap: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .header-icon {
      width: 38px; height: 38px; background: rgba(255,255,255,0.2);
      border-radius: 50%; display: flex; align-items: center;
      justify-content: center; font-size: 20px;
    }
    .header h1 { font-size: 17px; font-weight: 700; }
    .header p  { font-size: 12px; opacity: 0.85; margin-top: 2px; }
    .dot {
      width: 9px; height: 9px; background: #69f0ae; border-radius: 50%;
      margin-left: auto; box-shadow: 0 0 6px #69f0ae;
      animation: pulse 2s infinite;
    }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
    #chat {
      flex: 1; overflow-y: auto; padding: 20px 16px;
      display: flex; flex-direction: column; gap: 12px;
    }
    .msg {
      max-width: 78%; padding: 12px 16px; border-radius: 16px;
      font-size: 14px; line-height: 1.6; white-space: pre-wrap;
      word-break: break-word; animation: fi 0.2s ease;
    }
    @keyframes fi { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:none} }
    .user {
      background: #1565c0; color: white; align-self: flex-end;
      border-radius: 16px 16px 4px 16px;
    }
    .bot {
      background: white; color: #1a1a2e; align-self: flex-start;
      border-radius: 16px 16px 16px 4px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.08);
    }
    .meta { font-size:11px; color:#aaa; margin-top:6px; padding-top:6px; border-top:1px solid #f0f0f0; }
    .chips { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
    .chip {
      background:#e8f0fe; color:#1565c0; border:1px solid #c5d8fb;
      border-radius:20px; padding:5px 13px; font-size:12px; cursor:pointer; transition:all 0.15s;
    }
    .chip:hover { background:#1565c0; color:white; }
    .bar {
      background:white; border-top:1px solid #e0e0e0;
      padding:12px 16px; display:flex; gap:8px; align-items:center;
    }
    #inp {
      flex:1; padding:10px 16px; border:1.5px solid #e0e0e0;
      border-radius:24px; font-size:14px; outline:none; font-family:inherit;
      transition:border-color 0.2s;
    }
    #inp:focus { border-color:#1565c0; }
    #sendBtn {
      padding:10px 22px; background:#d50000; color:white;
      border:none; border-radius:24px; font-size:14px; font-weight:600;
      cursor:pointer; transition:background 0.2s; min-width:70px;
    }
    #sendBtn:hover { background:#b71c1c; }
    #clearBtn {
      padding:10px 14px; background:#f5f5f5; color:#666;
      border:none; border-radius:24px; font-size:13px; cursor:pointer;
    }
    #clearBtn:hover { background:#e0e0e0; }
  </style>
</head>
<body>

<div class="header">
  <div class="header-icon">ðŸ“¡</div>
  <div>
    <h1>Jio Antenna RAG Chatbot</h1>
    <p>Llama 3 Â· FAISS Â· 134,843 records indexed</p>
  </div>
  <div class="dot"></div>
</div>

<div id="chat">
  <div class="msg bot">ðŸ‘‹ Hello! Ask me anything about Jio antenna inventory.
    <div class="chips">
      <span class="chip" onclick="qa(this)">Sites with alarms in Maharashtra</span>
      <span class="chip" onclick="qa(this)">Show VSWR alarm sites</span>
      <span class="chip" onclick="qa(this)">Unidentified antennas band 2100</span>
      <span class="chip" onclick="qa(this)">Sites with missing RET data</span>
      <span class="chip" onclick="qa(this)">Recent antenna updates</span>
    </div>
  </div>
</div>

<div class="bar">
  <input id="inp" placeholder="Ask about SAP IDs, alarms, bands, antenna types..."
    onkeydown="if(event.key==='Enter')send()">
  <button id="sendBtn" onclick="send()">Send</button>
  <button id="clearBtn" onclick="clr()">Clear</button>
</div>

<script>
  const API = 'https://xr525wyykz4ksgcddh464p72oq0vawsf.lambda-url.ap-south-1.on.aws/';

  let hist = [];
  let busy = false;

  function qa(el) {
    document.getElementById('inp').value = el.textContent.trim();
    send();
  }

  function add(text, cls, n) {
    const c   = document.getElementById('chat');
    const id  = 'x' + Date.now();
    const mt  = n ? `<div class="meta">ðŸ“Š Retrieved ${n} records</div>` : '';
    const esc = text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    c.innerHTML += `<div class="msg ${cls}" id="${id}">${esc}${mt}</div>`;
    c.scrollTop  = c.scrollHeight;
    return id;
  }

  function rm(id) { const e=document.getElementById(id); if(e) e.remove(); }

  async function send() {
    if (busy) return;
    const inp = document.getElementById('inp');
    const msg = inp.value.trim();
    if (!msg) return;

    inp.value = '';
    add(msg, 'user');

    busy = true;
    const btn = document.getElementById('sendBtn');
    btn.textContent = '...';
    btn.style.background = '#888';

    const tid = add('Searching antenna records...', 'bot');

    try {
      const r = await fetch(API, {
        method:  'POST',
        headers: {'Content-Type':'application/json'},
        body:    JSON.stringify({message: msg, history: hist})
      });
      rm(tid);
      if (!r.ok) {
        add('Error ' + r.status + ': ' + await r.text(), 'bot');
      } else {
        const d = await r.json();
        add(d.reply, 'bot', d.retrieved);
        hist = d.history || [];
      }
    } catch(e) {
      rm(tid);
      add('Connection error: ' + e.message, 'bot');
    }

    busy = false;
    btn.textContent = 'Send';
    btn.style.background = '#d50000';
    inp.focus();
  }

  function clr() {
    hist = [];
    document.getElementById('chat').innerHTML = `
      <div class="msg bot">Chat cleared!
        <div class="chips">
          <span class="chip" onclick="qa(this)">Sites with alarms in Maharashtra</span>
          <span class="chip" onclick="qa(this)">Show VSWR alarm sites</span>
          <span class="chip" onclick="qa(this)">Unidentified antennas band 2100</span>
          <span class="chip" onclick="qa(this)">Sites with missing RET data</span>
        </div>
      </div>`;
  }
</script>
</body>
</html>
